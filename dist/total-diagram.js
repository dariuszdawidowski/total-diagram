class TotalJSON{serialize(e){return{format:"TotalJSON",mimetype:"text/total+json",version:1,id:metaviz.editor.id,name:metaviz.editor.name,nodes:e.map(e=>{const t={...e.params};return t.hasOwnProperty("set")&&delete t.set,t.hasOwnProperty("get")&&delete t.get,{id:e.id,type:e.constructor.name,transform:{x:e.transform.x,y:e.transform.y,z:e.transform.zindex,w:e.transform.w,h:e.transform.h},params:t,links:e.links.get("out").map(e=>e.end.id)}})}}}"undefined"!=typeof module&&module.exports&&(module.exports=TotalJSON);
class AnonymousTraversalSource{constructor(r){this.traversalSourceClass=r}static traversal(r){return new AnonymousTraversalSource(r||GraphTraversalSource)}withLists(r,s){return new this.traversalSourceClass(r,s)}}class GraphTraversalSource{constructor(r,s){this.vertices=r,this.edges=s}V(r=null){return new GraphTraversal(this.vertices,r)}E(r=null){return new GraphTraversal(this.edges,r)}}class GraphTraversal{constructor(r,s=null){if(this.result=null,null==s)this.result=r;else if("object"==typeof s){let e=s;for(;e.parentNode;)"classList"in e&&e.classList.contains("total-diagram-node")&&(this.result=r.find(r=>r.id==e.dataset.id)),e=e.parentNode}else"function"==typeof s?this.result=r.filter(r=>r instanceof s):"string"==typeof s&&(this.result=r.find(r=>r.id==s))}hasNext(){return null!=this.result&&"Array"!=this.result.constructor.name}next(){return this.result}toList(){return"Array"!=this.result.constructor.name?[this.result]:this.result}}"undefined"!=typeof module&&module.exports&&(module.exports={AnonymousTraversalSource:AnonymousTraversalSource,GraphTraversalSource:GraphTraversalSource,GraphTraversal:GraphTraversal});
class TotalDiagramNode{constructor(t={}){this.id="id"in t?t.id:crypto.randomUUID(),this.name="name"in t?t.name:null,this.transform={x:"x"in t?t.x:0,y:"y"in t?t.y:0,border:0,zindex:"zindex"in t?t.zindex:0,ox:0,oy:0,w:0,h:0,wmin:64,hmin:64,wmax:1024,hmax:1024,clear:()=>{this.transform.x=0,this.transform.y=0,this.transform.zindex=0,this.element.style.zIndex=0}},this.links={list:[],add:t=>{-1===this.links.list.indexOf(t)&&this.links.list.push(t)},del:t=>{const i=this.links.list.indexOf(t);-1!==i&&this.links.list.splice(i,1)},get:t=>"*"==t?this.links.list:"in"==t?this.links.list.filter(t=>t.end.id==this.id):"out"==t?this.links.list.filter(t=>t.start.id==this.id):"string"==typeof t?this.links.list.find(i=>i.id==t):null,update:()=>{this.links.list.forEach(t=>t.update())}},this.element=document.createElement("div"),this.element.classList.add("total-diagram-node"),this.element.style.zIndex=this.transform.zindex,this.element.dataset.id=this.id}destructor(){}awake(){}start(){}setSize(t){"width"in t&&(this.transform.w=t.width),"height"in t&&(this.transform.h=t.height),"minWidth"in t&&(this.transform.wmin=t.minWidth),"minHeight"in t&&(this.transform.hmin=t.minHeight),"maxWidth"in t&&(this.transform.wmax=t.maxWidth),"maxHeight"in t&&(this.transform.hmax=t.maxHeight),"width"in t&&(this.transform.w<this.transform.wmin&&(this.transform.w=this.transform.wmin),this.transform.w>this.transform.wmax&&(this.transform.w=this.transform.wmax)),"height"in t&&(this.transform.h<this.transform.hmin&&(this.transform.h=this.transform.hmin),this.transform.h>this.transform.hmax&&(this.transform.h=this.transform.hmax)),this.transform.border="border"in t?t.border:parseInt(getComputedStyle(this.element,null).getPropertyValue("border-left-width").replace("px",""))||0,"width"in t&&"height"in t&&this.setOrigin(),"width"in t&&(this.element.style.width=this.transform.w+"px"),"height"in t&&(this.element.style.height=this.transform.h+"px")}getSize(){return{width:this.transform.w,height:this.transform.h,minWidth:this.transform.wmin,minHeight:this.transform.hmin,maxWidth:this.transform.wmax,maxHeight:this.transform.hmax,border:this.transform.border}}setOrigin(){this.transform.ox=this.transform.w/2,this.transform.oy=this.transform.h/2}setPosition(t){this.transform.x=t.x,this.transform.y=t.y}getPosition(){return{x:this.transform.x,y:this.transform.y}}addPosition(t){this.transform.x+=t.x,this.transform.y+=t.y}subPosition(t){this.transform.x-=t.x,this.transform.y-=t.y}setStyle(t,i=null){null!==i&&(this.element.style[t]=i)}getStyle(t=null){return null!==t?this.element.style[t]:this.element.style}transparent(t){this.element.style.opacity=100==t?null:t/100}animated(t=!0){this.element.style.transition=t?"transform 0.5s ease-in-out":null}serialize(){return{id:this.id,type:this.constructor.name,x:this.transform.x,y:this.transform.y,w:this.transform.w,h:this.transform.h,zindex:this.transform.zindex}}setSortingZ(t){this.transform.zindex=t,this.element.style.zIndex=t}update(){this.element.style.transform=`translate(${this.transform.x-this.transform.ox-this.transform.border}px, ${this.transform.y-this.transform.oy-this.transform.border}px)`}}"undefined"!=typeof module&&module.exports&&(module.exports=TotalDiagramNode);
class TotalDiagramNodesManager{constructor(){this.render=null,this.list=[]}add(t){this.list.push(t),this.render.board.append(t.element),t.awake();const e=new CustomEvent("broadcast:addnode",{detail:t});this.render.container.dispatchEvent(e)}del(t){if("*"!=t){const e=t.links.get("*");for(;e.length;){const t=e.pop();this.render.links.del(t)}t.destructor(),t.element.remove();const s=this.list.indexOf(t);-1!==s&&this.list.splice(s,1);const n=new CustomEvent("broadcast:delnode",{detail:t});this.render.container.dispatchEvent(n)}else if("*"==t){this.list.forEach(t=>{t.destructor(),t.element.remove()}),this.list.length=0;const t=new CustomEvent("broadcast:delnodes",{detail:"*"});this.render.container.dispatchEvent(t)}}get(t){if("*"==t)return this.list;if(null!=t&&"object"==typeof t){let e=t;for(;e.parentNode;){if("classList"in e&&e.classList.contains("total-diagram-node"))return this.get(e.dataset.id);e=e.parentNode}}else{if("function"==typeof t)return this.list.filter(e=>e instanceof t);if("string"==typeof t)return this.list.find(e=>e.id==t)}return null}}"undefined"!=typeof module&&module.exports&&(module.exports=TotalDiagramNodesManager);
class TotalDiagramLink{constructor(t){this.id="id"in t?t.id:crypto.randomUUID(),this.start=t.start,this.start.links.add(this),this.end=t.end,this.end.links.add(this),this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.classList.add("link"),this.element.dataset.id=this.id}destructor(){this.start&&this.start.links.del(this),this.end&&this.end.links.del(this)}serialize(){return{id:this.id,type:this.constructor.name,start:this.start.id,end:this.end.id}}transparent(t){this.element.style.opacity=100==t?null:t/100}update(){}}"undefined"!=typeof module&&module.exports&&(module.exports=TotalDiagramLink);
class TotalDiagramLinksManager{constructor(){this.render=null,this.list=[]}add(t){if(!t.start||!t.end)return null;this.list.push(t),this.render.board.append(t.element);const e=new CustomEvent("broadcast:addlink",{detail:t});this.render.container.dispatchEvent(e)}del(t){if("*"!=t){t.destructor(),t.element.remove();const e=this.list.indexOf(t);-1!==e&&this.list.splice(e,1);const n=new CustomEvent("broadcast:dellink",{detail:t});this.render.container.dispatchEvent(n)}else{this.list.forEach(t=>{t.destructor(),t.element.remove()}),this.list.length=0;const t=new CustomEvent("broadcast:dellinks",{detail:"*"});this.render.container.dispatchEvent(t)}}get(t,e=null){if("*"==t)return this.list;if(e){for(const n of t.links.get("*"))for(const t of e.links.get("*"))if(n.id==t.id)return n;return null}return"string"==typeof t?this.list.find(e=>e.element.dataset.id==t):"function"==typeof t?this.list.filter(e=>e instanceof t):"object"==typeof t&&"dataset"in t?this.get(t.dataset.id):null}}"undefined"!=typeof module&&module.exports&&(module.exports=TotalDiagramLinksManager);
class TotalDiagramRenderHTML5{constructor(t){this.container=t.container,this.board=document.createElement("div"),this.board.id="total-diagram-attach",this.board.style.transformOrigin="0px 0px",this.board.style.width=0,this.board.style.height=0,this.board.style.overflow="visible",this.container.appendChild(this.board),this.size=this.container.getBoundingClientRect(),this.size.center={x:this.size.width/2,y:this.size.height/2},this.transform={x:0,y:0,z:1,delta:{x:0,y:0,length:function(){return Math.sqrt(this.x**2+this.y**2)}},timestamp:0,speed:0,add:function(t,s){this.delta.x=t,this.delta.y=s,this.x+=t,this.y+=s,this.calcSpeed()},calcSpeed:function(t=4e3){const s=Date.now();0==this.timestamp&&(this.timestamp=s);const i=s-this.timestamp;this.timestamp=s,this.speed=(this.speed+Math.min(t,this.delta.length()/(i/1e3)))/2}},window.addEventListener("resize",()=>{this.size=this.container.getBoundingClientRect(),this.size.center={x:this.size.width/2,y:this.size.height/2}}),this.nodes=t.nodes,this.nodes.render=this,this.links=t.links,this.links.render=this;const s=AnonymousTraversalSource.traversal;this.g=s().withLists(this.nodes.list,this.links.list)}pan(t,s){this.transform.add(t,s),this.update()}damp(t=.97,s=300){this.transform.calcSpeed();const i=()=>{this.transform.delta.x*=t,this.transform.delta.y*=t,this.transform.x+=this.transform.delta.x/window.devicePixelRatio,this.transform.y+=this.transform.delta.y/window.devicePixelRatio,this.update(),(Math.abs(this.transform.delta.x)>.1||Math.abs(this.transform.delta.y)>.1)&&requestAnimationFrame(i)};this.transform.speed>s&&i()}zoom(t,s,i,r){this.transform.delta.x=0,this.transform.delta.y=0;let e=this.transform.z;this.transform.z=Math.max(.1,Math.min(3,this.transform.z-i/r*this.transform.z)),e=this.transform.z/e;const h=this.board.getBoundingClientRect(),n=h.width/2+h.left-t,a=h.height/2+h.top-s;this.transform.x+=n*e-n,this.transform.y+=a*e-a,this.update()}pinchZoom(t,s,i,r,e){let h=this.transform.z;this.transform.z=Math.max(.1,Math.min(3,this.transform.z*e)),h=this.transform.z/h;const n=this.board.getBoundingClientRect(),a=n.width/2+n.left-(t+i)/2,o=n.height/2+n.top-(s+r)/2;this.transform.x+=a*h-a,this.transform.y+=o*h-o,this.update()}screen2World(t){return{x:Math.round((t.x-this.transform.x)/this.transform.z),y:Math.round((t.y-this.transform.y)/this.transform.z)}}world2Screen(t){return{x:Math.round(this.transform.x+t.x*this.transform.z),y:Math.round(this.transform.y+t.y*this.transform.z)}}center(t={x:0,y:0},s="none",i="hard",r=null){"smooth"==i&&(this.board.style.transition="transform 1s",setTimeout(()=>{this.board.style.removeProperty("transition")},1e3)),"reset"==s?this.transform.z=1:"focus"==s&&(this.transform.z=this.size.height/(r.height+r.margin)),this.transform.x=-t.x*this.transform.z+this.size.center.x,this.transform.y=-t.y*this.transform.z+this.size.center.y,this.update()}centerZoom(){this.transform.z=1,this.update()}focusBounds(){const t=this.getBounds(this.nodes.get("*").filter(t=>t.parent==this.nodes.parent)),s={x:this.size.width/t.width,y:this.size.height/t.height,avg:function(){return(this.x+this.y)/2}};this.transform.z=t.isZero()?1:Math.min(Math.max(s.avg(),.3),1),this.transform.x=-t.x*this.transform.z+this.size.center.x,this.transform.y=-t.y*this.transform.z+this.size.center.y,this.update()}getBounds(t){const s={left:1/0,right:-1/0,top:1/0,bottom:-1/0,x:0,y:0,width:0,height:0,isZero:function(){return Math.abs(this.width)<Number.EPSILON||Math.abs(this.height)<Number.EPSILON}};return t&&t.length?t.forEach(t=>{t.transform&&(s.left=Math.min(t.transform.x-t.transform.w/2,s.left),s.top=Math.min(t.transform.y-t.transform.h/2,s.top),s.right=Math.max(t.transform.x+t.transform.w/2,s.right),s.bottom=Math.max(t.transform.y+t.transform.h/2,s.bottom))}):(s.left=0,s.right=0,s.top=0,s.bottom=0),s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left+s.width/2,s.y=s.top+s.height/2,s}clear(){this.board.innerHTML="",this.links.del("*"),this.nodes.del("*")}update(){this.board.style.transform=`translate(${this.transform.x}px, ${this.transform.y}px) scale(${this.transform.z})`}redraw(){this.container.style.display="none";this.container.offsetHeight;this.container.style.display="block"}}"undefined"!=typeof module&&module.exports&&(module.exports=TotalDiagramRenderHTML5);